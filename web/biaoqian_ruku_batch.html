<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>批量标签入库</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<script src="../js/mui.min.js"></script>
		<script src="../js/api.js"></script>
		<script src="../js/jquery.js"></script>
		<script src="../js/jquery-1.11.1.js"></script>
		<script src="../js/jquery.xml2json.js.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/template-web.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/comment.css" />
		<style>

		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">批量标签入库</h1>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" id="segmented">
					<div class="mui-scroll">
						<a class="mui-control-item mui-active" href="#item1mobile">
							扫码
						</a>
						<a class="mui-control-item" href="#item2mobile">
							清单
						</a>
					</div>
				</div>
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<form class="mui-input-group" id="formId">
							<div class="mui-input-group">
								<div class="mui-input-row">
									<label onclick="clicked('commom/saomiao.html','location','web/biaoqian_ruku.html');">库位：</label>
									<input id="location" placeholder="请扫入库位" type="text" class="mui-input-clear">
								</div>
								<div class="mui-input-row">
									<label onclick="clicked('commom/saomiao.html','barcode','web/biaoqian_ruku.html');">条码：</label>
									<input id="barcode" placeholder="请扫入条码" type="text" class="mui-input-clear">
								</div>
								<div class="mui-input-row">
									<label>扫入品号：</label>
									<input id="scan_type" disabled type="text" class="mui-input-clear" style="background-color: #f3f3f3;">
								</div>
								<div class="mui-input-row">
									<label>箱数：</label>
									<input id="box_count" disabled type="text" class="mui-input-clear" style="background-color: #f3f3f3;">
								</div>
								<div class="mui-input-row">
									<label>总数：</label>
									<input id="total_num" disabled type="text" class="mui-input-clear" style="background-color: #f3f3f3;">
								</div>
								<div class="mui-input-row">
									<label>入库单号：</label>
									<input id="loc_num" disabled type="text" class="mui-input-clear" style="background-color: #f3f3f3;">
								</div>
							</div>
							<div class="mui-content-padded" align="center">
								<button type="button" class="mui-btn mui-btn-success" data-loading-icon="mui-spinner mui-spinner-custom" id="submit_code">确定</button>
								<button type="button" style="margin-top: 0.625rem;" class="mui-btn mui-btn-warning" data-loading-icon="mui-spinner mui-spinner-custom" id="clean_code">清空</button>
								<button type="button" style="margin-top: 0.625rem;" class="mui-btn mui-btn" data-loading-icon="mui-spinner mui-spinner-custom" id="history_code">历史记录</button>
							</div>
						</form>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content ">
						<div id="list">

							<div class="mui-card">
								<div class="mui-card-header">
									<span>条码:SDNFIWEHSNDKNDKJNS</span>
								</div>
								<div class="mui-card-content">		
									<div class="mui-card-footer">
										<span>数量：123123</span>
										<span><button onclick="reprintRecord()" class="mui-btn-danger">删除</button></span>
									</div>
								</div>
							</div>
							
						</div>
					</div>
				</div>

			</div>
			<script type="text/javascript">
				mui.init();
				window.addEventListener("changeBar", function(e) {
					var inputId = e.detail.inputId
					document.getElementById(inputId).value = e.detail.barcode
				});
				mui.plusReady(function() {
					/*mask = mui.createMask(function() { //遮罩层callback事件
						if (byId("selectDialog").style.display == "none") {
							return true; //如果没有弹出框，关闭遮罩层
						}
						return false; //返回true,点击关闭mask
					}); */
					/*创建蒙版*/
				})
				//遮罩层
				function showMask() { /*绑定处理事件*/
					top_value = $(document).scrollTop() //document.documentElement.scrollTop
					document.body.style.overflow = "hidden"
					document.body.style.width = "100%"
					document.body.style.height = "100%"
					document.body.style.position = "fixed"
					mask.show(); /*调用展示遮罩*/
				}
				
				function closeMask() { /*绑定处理事件*/
					document.body.style.overflow = "scroll"
					document.body.style.width = "100%"
					document.body.style.height = "100%"
					document.body.style.position = "relative"
					window.scrollTo(0, top_value); //回到原位置
					mask.close(); /*调用展示属性*/
				}
				
				function clicked(url, f1, urlId) { //扫描触发
					OpenWindow(f1, url, {
						urlId: urlId,
						inputId: f1
					});
				};
				
				$("#location").bind('keyup',function(event){
					if (event.keyCode == "13") {
						$('#barcode').focus();
					}
				})
				
				//监听条码扫描——扫描回车
				$('#barcode').bind('keyup', function(event) {
					if (event.keyCode == "13") {
						var code = $("#barcode").val();
						if (code == "") { 
							mui.toast("请先完善数据")
							return false;
						}
						checkBarcode(code);
					}
				})
				
				function checkBarcode(barcode){
					jQueryWeb("PDA_Get_Barcode_Rk", {
						"Barcode": barcode,//参数名未确认
					}, function(xmlHttpRequest, statu) {
						if (statu == 'success') {
							var json_obj = $.xml2json(xmlHttpRequest.responseXML);
							console.log(json_obj)
							//添加如果包含“NG”字符则弹出警告，无则将结果输出 loc_num
							if (json_obj.indexOf("NG") != -1) { //结果含NG字样时
								mui.alert(json_obj)
							} else {
								$("#loc_num").val(json_obj);//数据操作
								
								$("#barcode").val("");
								$("#barcode").focus();
								mui.toast("扫描成功");
							}
						}
					})
				}
			</script>
	</body>
</html>
